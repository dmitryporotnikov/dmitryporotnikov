<!doctype html><html lang=en-us dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This Bicep template automates the deployment of a highly available cluster of Red Hat Enterprise Linux (RHEL) virtual machines in Azure.
Parameters: # vmNames: Specifies the names of the virtual machines. The maximum length for each name is 15 characters. adminUsername: Sets the username for the administrator account on each VM. adminPassword: Sets the password for the administrator account on each VM. The minimum length for the password is 12 characters."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="http://localhost:1313/docs/legacy/2023-10-08-deploy-3-rhel-9_2-vms-with-shared-disks-to-form-a-cluster/"><meta property="og:site_name" content="My New Hugo Site"><meta property="og:title" content="Bicep: Deploy 3 RHEL 9.2 VMs with shared disks to form a cluster"><meta property="og:description" content="This Bicep template automates the deployment of a highly available cluster of Red Hat Enterprise Linux (RHEL) virtual machines in Azure.
Parameters: # vmNames: Specifies the names of the virtual machines. The maximum length for each name is 15 characters. adminUsername: Sets the username for the administrator account on each VM. adminPassword: Sets the password for the administrator account on each VM. The minimum length for the password is 12 characters."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2023-10-08T13:19:15+00:00"><meta property="article:modified_time" content="2023-10-08T13:19:15+00:00"><title>Bicep: Deploy 3 RHEL 9.2 VMs with shared disks to form a cluster | My New Hugo Site</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=canonical href=http://localhost:1313/docs/legacy/2023-10-08-deploy-3-rhel-9_2-vms-with-shared-disks-to-form-a-cluster/><link rel=stylesheet href=/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css integrity="sha256-MJt+0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.d9141972cbd985809409a02b47b12ef5a7f171564a36bd0b25cc703c61d91f7b.js integrity="sha256-2RQZcsvZhYCUCaArR7Eu9afxcVZKNr0LJcxwPGHZH3s=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>My New Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li class=book-section-flat><a href=/docs/legacy/>Example Site</a><ul><li><a href=/docs/legacy/2024-06-10-azure-linux-vm-time-synchronization/>Setting Up Chrony for Time Synchronization in Azure VMs</a></li><li><a href=/docs/legacy/2024-04-23-resolving-argument-list-too-long-error-linux/>Resolving the &amp;#8220;Argument list too long&amp;#8221; Error When Deleting Files in Linux</a></li><li><a href=/docs/legacy/2024-03-28-automatic-os-upgrade-vmss-issue/>Automatic OS Upgrade is not supported for this Virtual Machine Scale Set because a health probe or health extension was not specified.</a></li><li><a href=/docs/legacy/2024-03-27-one-liner-to-add-new-privileged-user-to-azure-linux-vm-using-run-command/>One-liner to add new privileged user to Azure Linux VM using run command</a></li><li><a href=/docs/legacy/2024-03-21-tracing-cron-jobs/>Troubleshooting a Non-Working Linux Cron Job with Strace</a></li><li><a href=/docs/legacy/2024-03-17-revitalize-dell-latitude-e5570-arch-linux/>Adventures with Arch Linux on an Old Laptop &amp;#8211; Dell Latitude E5570</a></li><li><a href=/docs/legacy/2024-02-11-windows-filtering-platform-wfp-overview/>Had some fun today learning about WFP drivers</a></li><li><a href=/docs/legacy/2024-02-09-kql-query-microsoft-services-retirement/>List services scheduled for retirement in Azure Graph / KQL</a></li><li><a href=/docs/legacy/2024-02-02-azure-vm-deployment-azure-ad-issue/>Encountering issues with Azure IAAS Virtual Machines not joining Azure AD post-deployment from a sysprepped template?</a></li><li><a href=/docs/legacy/2024-02-01-create-custom-filter-driver-windows/>How to Create Your Own Custom Filter Driver for Windows</a></li><li><a href=/docs/legacy/2024-01-30-install-windbg-windows-server-no-windows-store/>How to install WinDBG preview (Windows Store version) on Windows Server?</a></li><li><a href=/docs/legacy/2024-01-15-azzure-resource-graph-query-access/>Azure Resource Graph Queries to see who has access to Azure Subscriptions</a></li><li><a href=/docs/legacy/2023-12-01-recover-azure-vm-domain-admin-access/>PowerShell: Create a New Domain Admin User</a></li><li><a href=/docs/legacy/2023-11-07-enable-anonymous-access-azure-blob-storage/>Enabling Anonymous Access to Azure Blob Storage</a></li><li><a href=/docs/legacy/2023-11-06-manage-smb-1-windows/>Current configuration options for SMB 1.0 in Windows Environments</a></li><li><a href=/docs/legacy/2023-10-18-setting-up-a-flask-web-application-with-gunicorn-on-wsl/>Setting Up a Flask Web Application with Gunicorn on WSL</a></li><li><a href=/docs/legacy/2023-10-15-most-popular-operating-systems-desktop-laptops-1978-2023/>Most Popular Operating Systems (Desktop &amp;amp; Laptops) 1978 &amp;#8211; 2023</a></li><li><a href=/docs/legacy/2023-10-12-azure-vm-log-analysis-powershell/>PowerShell: Analyzing Virtual Machine Activity Logs to Determine Uptime and Downtime</a></li><li><a href=/docs/legacy/2023-10-11-thank-you-chatgpt/>Thank You, ChatGPT</a></li><li><a href=/docs/legacy/2023-10-11-nested-virtualization-madness-running-dosbox-inside-windows-xp-inside-windows-10-on-an-azure-vm-with-hyper-v/>Nested Virtualization Madness: Running DOSBox Inside Windows XP Inside Windows 10 on an Azure VM with Hyper-V</a></li><li><a href=/docs/legacy/2023-10-10-bypassing-azure-vm-limitations-script-based-solution/>PowerShell: Script-Based Workaround for Renaming Azure VMs and Switching to Unsupported Sizes</a></li><li><a href=/docs/legacy/2023-10-08-understanding-azure-capacity-reservations-guide/>Azure Capacity Reservations &amp;#038; Azure Reserved Instances</a></li><li><a href=/docs/legacy/2023-10-08-deploy-3-rhel-9_2-vms-with-shared-disks-to-form-a-cluster/ class=active>Bicep: Deploy 3 RHEL 9.2 VMs with shared disks to form a cluster</a></li><li><a href=/docs/legacy/2023-10-05-detecting-hypervisor-presence-using-cpuid-in-cpp/>C++: Detecting Hypervisor Presence Using CPUID Timing</a></li><li><a href=/docs/legacy/2023-10-03-linux-aio-performance-checker-real-time-diagnostics/>Streamlining Linux System Diagnostics: An Open-Source, Web-Based Approach</a></li><li><a href=/docs/legacy/2023-10-01-reverse-engineering-dotnet-applications-without-assembler/>Reverse Engineering .NET Applications Without Using Assembler</a></li><li><a href=/docs/legacy/2023-09-28-azure-rest-api-powershell-poc/>Rest API: Azure REST API POC</a></li><li><a href=/docs/legacy/2023-09-27-how-to-upgrade-legacy-azure-windows-vms/>How to Upgrade Legacy Azure Windows VMs Not Supported by Azure&amp;#8217;s Native In-Place Upgrade Feature</a></li><li><a href=/docs/legacy/2023-09-25-deploy-storage-spaces-on-azure-vm/>Deploy Storage Spaces on a Single Virtual Machine to Get Optimal Performance/Cost Ratio</a></li><li><a href=/docs/legacy/2023-09-24-windows-server-azure-vm-in-place-upgrade/>In Place Upgrade Your Windows Server Azure VM: Step by Step Guide</a></li><li><a href=/docs/legacy/2023-09-22-how-to-resolve-the-nla-error-in-azure-vms-when-the-computer-object-is-removed-from-active-directory/>How to resolve the NLA error in Azure VMs when the computer object is removed from Active Directory</a></li><li><a href=/docs/legacy/2023-09-22-simulating-memory-leaks-in-c-with-the-c-memory-leaker-tool-veryleakycauldron/>C++: Memory Leaker Tool &amp;#8211; VeryLeakyCauldron</a></li><li><a href=/docs/legacy/2023-09-21-why-cant-i-resize-the-underlying-storage-used-by-storage-spaces-direct/>Why can&amp;#8217;t I resize the underlying storage used by Storage Spaces?</a></li><li><a href=/docs/legacy/2023-09-20-powershell-download-and-use-azcopy-to-upload-files-to-azure-blob-storage/>PowerShell: Download and Use AzCopy (Windows) to Upload Files to Azure Blob Storage</a></li><li><a href=/docs/legacy/2023-09-20-powershell-automating-windows-crash-control-configuration/>PowerShell: Automating Windows Crash Control Configuration</a></li><li><a href=/docs/legacy/2023-09-18-powershell-create-a-nat-vmswitch-on-hyper-v/>PowerShell: Create a NAT VMSwitch on Hyper-V</a></li><li><a href=/docs/legacy/2023-09-18-powershell-download-iso-from-msdn-directly-to-the-server-vm/>PowerShell: Download ISO from MSDN Directly to the Server/VM</a></li><li><a href=/docs/legacy/2023-09-17-overview-of-shedevrum-yandexs-online-image-content-generation-service/>Overview of &amp;#8220;Shedevrum&amp;#8221;: Yandex&amp;#8217;s Online Image/Content Generation Service</a></li><li><a href=/docs/legacy/2023-09-16-hosting-a-custom-chatgpt-web-ui-with-your-own-api-keys/>Hosting a Custom ChatGPT Web UI with Your Own API Keys</a></li><li><a href=/docs/legacy/2023-09-13-powershell-gather-dns-server-logs-from-windows/>PowerShell: Gather DNS Server Logs from Windows</a></li><li><a href=/docs/legacy/2023-09-11-tracking-last-domain-login-events-on-azure-vms-a-handy-script/>Powershell: Tracking Last Domain Login Events on Azure VMs</a></li><li><a href=/docs/legacy/2023-09-10-how-hyper-v-works-high-level-overview/>How Hyper-V Works, High Level Overview</a></li><li><a href=/docs/legacy/2023-09-05-understanding-amsi-the-antimalware-scan-interface-in-windows-systems/>Understanding AMSI: The Antimalware Scan Interface in Windows Systems</a></li><li><a href=/docs/legacy/2023-08-28-how-to-track-registry-key-modifications-using-process-monitor/>How to Track Registry Key Modifications Using Process Monitor</a></li><li><a href=/docs/legacy/2023-08-27-bicep-execute-a-runcommand-on-already-running-azure-virtual-machine/>Bicep: Execute a RunCommand on already running Azure Virtual Machine</a></li><li><a href=/docs/legacy/2023-08-25-azure-nested-virtualization-hyper-v-cannot-be-installed-because-virtualization-support-is-not-enabled-in-the-bios/>Azure Nested Virtualization: Hyper-V cannot be installed because virtualization support is not enabled in the BIOS.</a></li><li><a href=/docs/legacy/2023-08-24-how-to-restart-group-policy-client-service-gpsvc/>How to restart Group Policy Client Service (GPSVC)</a></li><li><a href=/docs/legacy/2023-08-24-free-opnsense-firewall-nva-in-azure/>Free OPNsense Firewall NVA in Azure</a></li><li><a href=/docs/legacy/2023-08-23-youve-mounted-your-storage-account-but-you-see-that-the-space-available-is-less-than-visible-on-azure-portal/>You&amp;#8217;ve mounted your storage account, but you see that the space available is less than visible on Azure Portal</a></li><li><a href=/docs/legacy/2023-08-22-deploy-cse-custom-script-extension-using-managed-identity-to-authenticate-against-storage-account-where-script-is-stored-on-existing-running-vm/>Deploy CSE (Custom Script Extension) using Managed Identity to authenticate against storage account where script is stored on existing running VM</a></li><li><a href=/docs/legacy/2023-08-22-c-working-with-azure-imds/>C#: Working with Azure IMDS</a></li><li><a href=/docs/legacy/2023-08-22-c-check-if-service-exists-via-wmi/>C#: Check if service exists via WMI</a></li><li><a href=/docs/legacy/2023-08-22-capture-network-traffic-using-windows-built-in-tools/>Capture network traffic using windows built in tools</a></li></ul></li><li class=book-section-flat><a href=/docs/example/>Example Site</a><ul><li><a href=/docs/example/table-of-contents/>Table of Contents</a><ul><li><a href=/docs/example/table-of-contents/with-toc/>With ToC</a></li><li><a href=/docs/example/table-of-contents/without-toc/>Without ToC</a></li></ul></li><li><input type=checkbox id=section-3049b9efa63db187c30edc63a05cabc2 class=toggle>
<label for=section-3049b9efa63db187c30edc63a05cabc2 class="flex justify-between"><a role=button>Collapsed</a></label><ul><li><a href=/docs/example/collapsed/3rd-level/>3rd Level</a><ul><li><a href=/docs/example/collapsed/3rd-level/4th-level/>4th Level</a></li></ul></li></ul></li></ul></li><li class=book-section-flat><a href=/docs/example2/>Example Site</a><ul><li><a href=/docs/example2/table-of-contents/>Table of Contents</a><ul><li><a href=/docs/example2/table-of-contents/with-toc/>With ToC</a></li><li><a href=/docs/example2/table-of-contents/without-toc/>Without ToC</a></li></ul></li><li><input type=checkbox id=section-241c84bb3eab034a2a9fc6034c481dd5 class=toggle>
<label for=section-241c84bb3eab034a2a9fc6034c481dd5 class="flex justify-between"><a role=button>Collapsed</a></label><ul><li><a href=/docs/example2/collapsed/3rd-level/>3rd Level</a><ul><li><a href=/docs/example2/collapsed/3rd-level/4th-level/>4th Level</a></li></ul></li></ul></li></ul></li><li class=book-section-flat><span>Shortcodes</span><ul><li><a href=/docs/shortcodes/buttons/>Buttons</a></li><li><a href=/docs/shortcodes/columns/>Columns</a></li><li><a href=/docs/shortcodes/details/>Details</a></li><li><a href=/docs/shortcodes/expand/>Expand</a></li><li><a href=/docs/shortcodes/hints/>Hints</a></li><li><a href=/docs/shortcodes/mermaid/>Mermaid</a></li><li><input type=checkbox id=section-d4c83c0dd655503a3da63d0c6550ed41 class=toggle>
<label for=section-d4c83c0dd655503a3da63d0c6550ed41 class="flex justify-between"><a href=/docs/shortcodes/section/>Section</a></label><ul><li><a href=/docs/shortcodes/section/first-page/>First Page</a></li><li><a href=/docs/shortcodes/section/second-page/>Second Page</a></li></ul></li><li><a href=/docs/shortcodes/tabs/>Tabs</a></li><li><a href=/docs/shortcodes/katex/>KaTeX</a></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Bicep: Deploy 3 RHEL 9.2 VMs with shared disks to form a cluster</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><p>This Bicep template automates the deployment of a highly available cluster of Red Hat Enterprise Linux (RHEL) virtual machines in Azure.</p><h4 id=span-classez-toc-section-idparametersspanparametersspan-classez-toc-section-endspan>Parameters:
<a class=anchor href=#span-classez-toc-section-idparametersspanparametersspan-classez-toc-section-endspan>#</a></h4><ul><li><strong>vmNames</strong>: Specifies the names of the virtual machines. The maximum length for each name is 15 characters.</li><li><strong>adminUsername</strong>: Sets the username for the administrator account on each VM.</li><li><strong>adminPassword</strong>: Sets the password for the administrator account on each VM. The minimum length for the password is 12 characters.</li><li><strong>datasizes</strong>: Defines the sizes of the disks you want to add to the cluster.</li><li><strong>vmSize</strong>: Specifies the size of the virtual machines. The default size is <code>Standard_B2ms</code>.</li><li><strong>location</strong>: Sets the Azure region where all resources will be deployed. The default is the location of the resource group.</li><li><strong>shared_disksize</strong>: Specifies the size of the shared disk in gigabytes.</li><li><strong>vnetname</strong>: Sets the name of your Virtual Network (VNET).</li><li><strong>subnetname</strong>: Sets the name of your subnet within the VNET.</li><li><strong>vnetrg</strong>: Specifies the resource group where your VNET resides.</li><li><strong>DNS1</strong>: Sets the primary DNS server.</li></ul><h4 id=span-classez-toc-section-idtemplatespantemplatespan-classez-toc-section-endspan>Template
<a class=anchor href=#span-classez-toc-section-idtemplatespantemplatespan-classez-toc-section-endspan>#</a></h4><p>@description(&lsquo;Username for the Virtual Machine.&rsquo;)
param adminUsername string = &lsquo;azureuser&rsquo;</p><p>@description(&lsquo;Password for the Virtual Machine.&rsquo;)
@minLength(12)
param adminPassword string</p><p>@description(&lsquo;How many disks you want to add to failover cluster?&rsquo;)
param datasizes array = [
1
2
3
]</p><p>@description(&lsquo;Size of the virtual machine.&rsquo;)
param vmSize string = &lsquo;Standard_B2ms&rsquo;</p><p>@description(&lsquo;Location for all resources.&rsquo;)
param location string = resourceGroup().location</p><p>@description(&lsquo;Shared disk size in gigabytes&rsquo;)
param shared_disksize int = 125</p><p>@description(&lsquo;Your VNET name&rsquo;)
param vnetname string = &lsquo;EUN-Virtual-Network&rsquo;</p><p>@description(&lsquo;Your Subnet name&rsquo;)
param subnetname string = &lsquo;SD-WAN&rsquo;</p><p>@description(&lsquo;Your VNET RG name&rsquo;)
param vnetrg string = &lsquo;SD-WAN&rsquo;</p><p>@description(&lsquo;DNS Server 1&rsquo;)
param DNS1 string = &lsquo;192.168.1.210&rsquo;</p><p>resource ngfwvnet &lsquo;Microsoft.Network/virtualnetworks@2021-02-01&rsquo; existing = {
name: vnetname
scope: resourceGroup(vnetrg)
}
resource subnet &lsquo;Microsoft.Network/virtualNetworks/subnets@2021-02-01&rsquo; existing = {
parent: ngfwvnet
name: subnetname
}</p><p>resource availabilitySet &lsquo;Microsoft.Compute/availabilitySets@2022-03-01&rsquo; = {
name: &lsquo;ClusterAS&rsquo;
location: location
sku: {
name: &lsquo;Aligned&rsquo;
}
properties: {
platformFaultDomainCount: 3
platformUpdateDomainCount: 3
}
}</p><p>resource clusterdisk &lsquo;Microsoft.Compute/disks@2022-03-02&rsquo; = [for (datasize, lun) in datasizes: {
name: &lsquo;clusterdisk-00${lun}&rsquo;
location: location
sku: {
name: &lsquo;Premium_LRS&rsquo;
}
properties: {
burstingEnabled: false
creationData: {
createOption: &lsquo;Empty&rsquo;
}
diskSizeGB: shared_disksize
maxShares: 3
}
}]</p><p>output datadisksId array = [for i in range(0, length(datasizes)): {
name: &lsquo;clusterdisk-00${i}&rsquo;
id: clusterdisk[i].id
}]
output datadisks array = [for i in range(0, length(datasizes)): {
name: &lsquo;clusterdisk-00${i}&rsquo;
id: clusterdisk[i]
}]</p><p>resource vms &lsquo;Microsoft.Compute/virtualMachines@2022-03-01&rsquo; = [for (vmName, index) in vmNames: {
name: vmName
location: location
properties: {
availabilitySet: {
id: availabilitySet.id
}
hardwareProfile: {
vmSize: vmSize
}
osProfile: {
computerName: vmName
adminUsername: adminUsername
adminPassword: adminPassword
}
storageProfile: {
imageReference: {
publisher: &lsquo;RedHat&rsquo;
offer: &lsquo;RHEL&rsquo;
sku: &lsquo;9_2&rsquo;
version: &rsquo;latest&rsquo;
}
osDisk: {
createOption: &lsquo;FromImage&rsquo;
name: &lsquo;${vmName}-OSdisk&rsquo;
managedDisk: {
storageAccountType: &lsquo;StandardSSD_LRS&rsquo;
}
}
dataDisks: [for (disk, lun) in datasizes: {
lun: lun+2
createOption: &lsquo;Attach&rsquo;
managedDisk: {
storageAccountType: &lsquo;StandardSSD_LRS&rsquo;
id: clusterdisk[lun].id
}
toBeDetached: false
deleteOption: &lsquo;Detach&rsquo;
caching: &lsquo;None&rsquo;
}]
}
networkProfile: {
networkInterfaces: [
{
id: nic[index].id
}
]
}
diagnosticsProfile: {
bootDiagnostics: {
enabled: false
}
}
}
}]</p><p>resource nic &lsquo;Microsoft.Network/networkInterfaces@2022-01-01&rsquo; = [for (vmName, index) in vmNames: {
name: &lsquo;${vmName}-NIC0${index+1}&rsquo;
location: location
dependsOn: [
subnet
]
properties: {
dnsSettings: {
dnsServers: [
DNS1
]
}
ipConfigurations: [
{
name: &lsquo;ipConfig&rsquo;
properties: {
privateIPAllocationMethod: &lsquo;Dynamic&rsquo;<br>subnet: {
id: subnet.id
}
primary: true
privateIPAddressVersion: &lsquo;IPv4&rsquo;
}
}
]
}
}]
" role=&ldquo;button&rdquo; style=&ldquo;color:#D4D4D4;display:none&rdquo; tabindex=&ldquo;0&rdquo;>```
@description(&lsquo;Name of the virtual machines.&rsquo;)
@maxLength(15)
param vmNames array = [&lsquo;NAMEYOURVM1&rsquo;, &lsquo;NAMEYOURVM2&rsquo;, &lsquo;NAMEYOURVM3&rsquo;]
@description(&lsquo;Username for the Virtual Machine.&rsquo;)
param adminUsername string = &lsquo;azureuser&rsquo;
@description(&lsquo;Password for the Virtual Machine.&rsquo;)
@minLength(12)
param adminPassword string
@description(&lsquo;How many disks you want to add to failover cluster?&rsquo;)
param datasizes array = [
1
2
3
]
@description(&lsquo;Size of the virtual machine.&rsquo;)
param vmSize string = &lsquo;Standard_B2ms&rsquo;
@description(&lsquo;Location for all resources.&rsquo;)
param location string = resourceGroup().location
@description(&lsquo;Shared disk size in gigabytes&rsquo;)
param shared_disksize int = 125
@description(&lsquo;Your VNET name&rsquo;)
param vnetname string = &lsquo;EUN-Virtual-Network&rsquo;
@description(&lsquo;Your Subnet name&rsquo;)
param subnetname string = &lsquo;SD-WAN&rsquo;
@description(&lsquo;Your VNET RG name&rsquo;)
param vnetrg string = &lsquo;SD-WAN&rsquo;
@description(&lsquo;DNS Server 1&rsquo;)
param DNS1 string = &lsquo;192.168.1.210&rsquo;
resource ngfwvnet &lsquo;Microsoft.Network/virtualnetworks@2021-02-01&rsquo; existing = {
name: vnetname
scope: resourceGroup(vnetrg)
}
resource subnet &lsquo;Microsoft.Network/virtualNetworks/subnets@2021-02-01&rsquo; existing = {
parent: ngfwvnet
name: subnetname
}
resource availabilitySet &lsquo;Microsoft.Compute/availabilitySets@2022-03-01&rsquo; = {
name: &lsquo;ClusterAS&rsquo;
location: location
sku: {
name: &lsquo;Aligned&rsquo;
}
properties: {
platformFaultDomainCount: 3
platformUpdateDomainCount: 3
}
}
resource clusterdisk &lsquo;Microsoft.Compute/disks@2022-03-02&rsquo; = [for (datasize, lun) in datasizes: {
name: &lsquo;clusterdisk-00${lun}&rsquo;
location: location
sku: {
name: &lsquo;Premium_LRS&rsquo;
}
properties: {
burstingEnabled: false
creationData: {
createOption: &lsquo;Empty&rsquo;
}
diskSizeGB: shared_disksize
maxShares: 3
}
}]
output datadisksId array = [for i in range(0, length(datasizes)): {
name: &lsquo;clusterdisk-00${i}&rsquo;
id: clusterdisk[i].id
}]
output datadisks array = [for i in range(0, length(datasizes)): {
name: &lsquo;clusterdisk-00${i}&rsquo;
id: clusterdisk[i]
}]
resource vms &lsquo;Microsoft.Compute/virtualMachines@2022-03-01&rsquo; = [for (vmName, index) in vmNames: {
name: vmName
location: location
properties: {
availabilitySet: {
id: availabilitySet.id
}
hardwareProfile: {
vmSize: vmSize
}
osProfile: {
computerName: vmName
adminUsername: adminUsername
adminPassword: adminPassword
}
storageProfile: {
imageReference: {
publisher: &lsquo;RedHat&rsquo;
offer: &lsquo;RHEL&rsquo;
sku: &lsquo;9_2&rsquo;
version: &lsquo;latest&rsquo;
}
osDisk: {
createOption: &lsquo;FromImage&rsquo;
name: &rsquo;${vmName}-OSdisk&rsquo;
managedDisk: {
storageAccountType: &lsquo;StandardSSD_LRS&rsquo;
}
}
dataDisks: [for (disk, lun) in datasizes: {
lun: lun+2
createOption: &lsquo;Attach&rsquo;
managedDisk: {
storageAccountType: &lsquo;StandardSSD_LRS&rsquo;
id: clusterdisk[lun].id
}
toBeDetached: false
deleteOption: &lsquo;Detach&rsquo;
caching: &lsquo;None&rsquo;
}]
}
networkProfile: {
networkInterfaces: [
{
id: nic[index].id
}
]
}
diagnosticsProfile: {
bootDiagnostics: {
enabled: false
}
}
}
}]
resource nic &lsquo;Microsoft.Network/networkInterfaces@2022-01-01&rsquo; = [for (vmName, index) in vmNames: {
name: &rsquo;${vmName}-NIC0${index+1}&rsquo;
location: location
dependsOn: [
subnet
]
properties: {
dnsSettings: {
dnsServers: [
DNS1
]
}
ipConfigurations: [
{
name: &lsquo;ipConfig&rsquo;
properties: {
privateIPAllocationMethod: &lsquo;Dynamic&rsquo; subnet: {
id: subnet.id
}
primary: true
privateIPAddressVersion: &lsquo;IPv4&rsquo;
}
}
]
}
}]</p><pre tabindex=0><code>
&lt;/div&gt;
</code></pre></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></div></aside></main></body></html>