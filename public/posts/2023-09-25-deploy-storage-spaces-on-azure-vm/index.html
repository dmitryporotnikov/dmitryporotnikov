<!doctype html><html lang=en-us dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Storage Spaces is a feature of Windows Server that allows you to pool multiple physical disks together to create a single virtual disk. This can be useful for a variety of reasons, such as:
To increase the overall capacity of your storage. To improve the performance of your storage by distributing data across multiple disks. To get azure host caching feature on disks that are higher than 4 TB. In this article, I will show you how to deploy Storage Spaces on a single virtual machine in Azure to achieve optimal storage performance with minimal cost."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="http://localhost:1313/posts/2023-09-25-deploy-storage-spaces-on-azure-vm/"><meta property="og:site_name" content="My New Hugo Site"><meta property="og:title" content="Deploy Storage Spaces on a Single Virtual Machine to Get Optimal Performance/Cost Ratio"><meta property="og:description" content="Storage Spaces is a feature of Windows Server that allows you to pool multiple physical disks together to create a single virtual disk. This can be useful for a variety of reasons, such as:
To increase the overall capacity of your storage. To improve the performance of your storage by distributing data across multiple disks. To get azure host caching feature on disks that are higher than 4 TB. In this article, I will show you how to deploy Storage Spaces on a single virtual machine in Azure to achieve optimal storage performance with minimal cost."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-25T22:10:24+00:00"><meta property="article:modified_time" content="2023-09-25T22:10:24+00:00"><title>Deploy Storage Spaces on a Single Virtual Machine to Get Optimal Performance/Cost Ratio | My New Hugo Site</title>
<link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png><link rel=canonical href=http://localhost:1313/posts/2023-09-25-deploy-storage-spaces-on-azure-vm/><link rel=stylesheet href=/book.min.309b7ed028807cdb68d8d61e26d609f48369c098dbf5e4d8c0dcf4cdf49feafc.css integrity="sha256-MJt+0CiAfNto2NYeJtYJ9INpwJjb9eTYwNz0zfSf6vw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.5e3405a20a279a1622d7b2774d07bd00a122eee0ce2bd1725d7d77f6f095ef28.js integrity="sha256-XjQFogonmhYi17J3TQe9AKEi7uDOK9FyXX139vCV7yg=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>My New Hugo Site</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li class=book-section-flat><a href=/docs/example/>Example Site</a><ul><li><a href=/docs/example/table-of-contents/>Table of Contents</a><ul><li><a href=/docs/example/table-of-contents/with-toc/>With ToC</a></li><li><a href=/docs/example/table-of-contents/without-toc/>Without ToC</a></li></ul></li><li><input type=checkbox id=section-3049b9efa63db187c30edc63a05cabc2 class=toggle>
<label for=section-3049b9efa63db187c30edc63a05cabc2 class="flex justify-between"><a role=button>Collapsed</a></label><ul><li><a href=/docs/example/collapsed/3rd-level/>3rd Level</a><ul><li><a href=/docs/example/collapsed/3rd-level/4th-level/>4th Level</a></li></ul></li></ul></li></ul></li><li class=book-section-flat><a href=/docs/example2/>Example Site</a><ul><li><a href=/docs/example2/table-of-contents/>Table of Contents</a><ul><li><a href=/docs/example2/table-of-contents/with-toc/>With ToC</a></li><li><a href=/docs/example2/table-of-contents/without-toc/>Without ToC</a></li></ul></li><li><input type=checkbox id=section-241c84bb3eab034a2a9fc6034c481dd5 class=toggle>
<label for=section-241c84bb3eab034a2a9fc6034c481dd5 class="flex justify-between"><a role=button>Collapsed</a></label><ul><li><a href=/docs/example2/collapsed/3rd-level/>3rd Level</a><ul><li><a href=/docs/example2/collapsed/3rd-level/4th-level/>4th Level</a></li></ul></li></ul></li></ul></li><li><a href=/docs/legacy/2024-06-10-azure-linux-vm-time-synchronization/>Setting Up Chrony for Time Synchronization in Azure VMs</a></li><li><a href=/docs/legacy/2024-05-23-p-vs-np-the-biggest-puzzle-in-computer-science/>P vs. NP: The Biggest Puzzle in Computer Science</a></li><li><a href=/docs/legacy/2024-04-23-resolving-argument-list-too-long-error-linux/>Resolving the &amp;#8220;Argument list too long&amp;#8221; Error When Deleting Files in Linux</a></li><li><a href=/docs/legacy/2024-03-28-automatic-os-upgrade-vmss-issue/>Automatic OS Upgrade is not supported for this Virtual Machine Scale Set because a health probe or health extension was not specified.</a></li><li><a href=/docs/legacy/2024-03-27-one-liner-to-add-new-privileged-user-to-azure-linux-vm-using-run-command/>One-liner to add new privileged user to Azure Linux VM using run command</a></li><li><a href=/docs/legacy/2024-03-21-tracing-cron-jobs/>Troubleshooting a Non-Working Linux Cron Job with Strace</a></li><li><a href=/docs/legacy/2024-03-17-revitalize-dell-latitude-e5570-arch-linux/>Adventures with Arch Linux on an Old Laptop &amp;#8211; Dell Latitude E5570</a></li><li><a href=/docs/legacy/2024-02-11-windows-filtering-platform-wfp-overview/>Had some fun today learning about WFP drivers</a></li><li><a href=/docs/legacy/2024-02-09-kql-query-microsoft-services-retirement/>List services scheduled for retirement in Azure Graph / KQL</a></li><li><a href=/docs/legacy/2024-02-02-azure-vm-deployment-azure-ad-issue/>Encountering issues with Azure IAAS Virtual Machines not joining Azure AD post-deployment from a sysprepped template?</a></li><li><a href=/docs/legacy/2024-02-01-create-custom-filter-driver-windows/>How to Create Your Own Custom Filter Driver for Windows</a></li><li><a href=/docs/legacy/2024-01-30-install-windbg-windows-server-no-windows-store/>How to install WinDBG preview (Windows Store version) on Windows Server?</a></li><li><a href=/docs/legacy/2024-01-15-azzure-resource-graph-query-access/>Azure Resource Graph Queries to see who has access to Azure Subscriptions</a></li><li><a href=/docs/legacy/2023-12-01-recover-azure-vm-domain-admin-access/>PowerShell: Create a New Domain Admin User</a></li><li><a href=/docs/legacy/2023-11-07-enable-anonymous-access-azure-blob-storage/>Enabling Anonymous Access to Azure Blob Storage</a></li><li><a href=/docs/legacy/2023-11-06-manage-smb-1-windows/>Current configuration options for SMB 1.0 in Windows Environments</a></li><li><a href=/docs/legacy/2023-10-18-setting-up-a-flask-web-application-with-gunicorn-on-wsl/>Setting Up a Flask Web Application with Gunicorn on WSL</a></li><li><a href=/docs/legacy/2023-10-15-most-popular-operating-systems-desktop-laptops-1978-2023/>Most Popular Operating Systems (Desktop &amp;amp; Laptops) 1978 &amp;#8211; 2023</a></li><li><a href=/docs/legacy/2023-10-12-azure-vm-log-analysis-powershell/>PowerShell: Analyzing Virtual Machine Activity Logs to Determine Uptime and Downtime</a></li><li><a href=/docs/legacy/2023-10-11-thank-you-chatgpt/>Thank You, ChatGPT</a></li><li><a href=/docs/legacy/2023-10-11-nested-virtualization-madness-running-dosbox-inside-windows-xp-inside-windows-10-on-an-azure-vm-with-hyper-v/>Nested Virtualization Madness: Running DOSBox Inside Windows XP Inside Windows 10 on an Azure VM with Hyper-V</a></li><li><a href=/docs/legacy/2023-10-10-bypassing-azure-vm-limitations-script-based-solution/>PowerShell: Script-Based Workaround for Renaming Azure VMs and Switching to Unsupported Sizes</a></li><li><a href=/docs/legacy/2023-10-08-understanding-azure-capacity-reservations-guide/>Azure Capacity Reservations &amp;#038; Azure Reserved Instances</a></li><li><a href=/docs/legacy/2023-10-08-deploy-3-rhel-9_2-vms-with-shared-disks-to-form-a-cluster/>Bicep: Deploy 3 RHEL 9.2 VMs with shared disks to form a cluster</a></li><li><a href=/docs/legacy/2023-10-05-detecting-hypervisor-presence-using-cpuid-in-cpp/>C++: Detecting Hypervisor Presence Using CPUID Timing</a></li><li><a href=/docs/legacy/2023-10-03-linux-aio-performance-checker-real-time-diagnostics/>Streamlining Linux System Diagnostics: An Open-Source, Web-Based Approach</a></li><li><a href=/docs/legacy/2023-10-01-reverse-engineering-dotnet-applications-without-assembler/>Reverse Engineering .NET Applications Without Using Assembler</a></li><li><a href=/docs/legacy/2023-09-28-azure-rest-api-powershell-poc/>Rest API: Azure REST API POC</a></li><li><a href=/docs/legacy/2023-09-27-how-to-upgrade-legacy-azure-windows-vms/>How to Upgrade Legacy Azure Windows VMs Not Supported by Azure&amp;#8217;s Native In-Place Upgrade Feature</a></li><li><a href=/docs/legacy/2023-09-25-deploy-storage-spaces-on-azure-vm/>Deploy Storage Spaces on a Single Virtual Machine to Get Optimal Performance/Cost Ratio</a></li><li><a href=/docs/legacy/2023-09-24-windows-server-azure-vm-in-place-upgrade/>In Place Upgrade Your Windows Server Azure VM: Step by Step Guide</a></li><li><a href=/docs/legacy/2023-09-22-how-to-resolve-the-nla-error-in-azure-vms-when-the-computer-object-is-removed-from-active-directory/>How to resolve the NLA error in Azure VMs when the computer object is removed from Active Directory</a></li><li><a href=/docs/legacy/2023-09-22-simulating-memory-leaks-in-c-with-the-c-memory-leaker-tool-veryleakycauldron/>C++: Memory Leaker Tool &amp;#8211; VeryLeakyCauldron</a></li><li><a href=/docs/legacy/2023-09-21-why-cant-i-resize-the-underlying-storage-used-by-storage-spaces-direct/>Why can&amp;#8217;t I resize the underlying storage used by Storage Spaces?</a></li><li><a href=/docs/legacy/2023-09-20-powershell-download-and-use-azcopy-to-upload-files-to-azure-blob-storage/>PowerShell: Download and Use AzCopy (Windows) to Upload Files to Azure Blob Storage</a></li><li><a href=/docs/legacy/2023-09-20-powershell-automating-windows-crash-control-configuration/>PowerShell: Automating Windows Crash Control Configuration</a></li><li><a href=/docs/legacy/2023-09-18-powershell-create-a-nat-vmswitch-on-hyper-v/>PowerShell: Create a NAT VMSwitch on Hyper-V</a></li><li><a href=/docs/legacy/2023-09-18-powershell-download-iso-from-msdn-directly-to-the-server-vm/>PowerShell: Download ISO from MSDN Directly to the Server/VM</a></li><li><a href=/docs/legacy/2023-09-17-overview-of-shedevrum-yandexs-online-image-content-generation-service/>Overview of &amp;#8220;Shedevrum&amp;#8221;: Yandex&amp;#8217;s Online Image/Content Generation Service</a></li><li><a href=/docs/legacy/2023-09-16-hosting-a-custom-chatgpt-web-ui-with-your-own-api-keys/>Hosting a Custom ChatGPT Web UI with Your Own API Keys</a></li><li><a href=/docs/legacy/2023-09-13-powershell-gather-dns-server-logs-from-windows/>PowerShell: Gather DNS Server Logs from Windows</a></li><li><a href=/docs/legacy/2023-09-11-tracking-last-domain-login-events-on-azure-vms-a-handy-script/>Powershell: Tracking Last Domain Login Events on Azure VMs</a></li><li><a href=/docs/legacy/2023-09-10-how-hyper-v-works-high-level-overview/>How Hyper-V Works, High Level Overview</a></li><li><a href=/docs/legacy/2023-09-05-understanding-amsi-the-antimalware-scan-interface-in-windows-systems/>Understanding AMSI: The Antimalware Scan Interface in Windows Systems</a></li><li><a href=/docs/legacy/2023-08-28-how-to-track-registry-key-modifications-using-process-monitor/>How to Track Registry Key Modifications Using Process Monitor</a></li><li><a href=/docs/legacy/2023-08-27-bicep-execute-a-runcommand-on-already-running-azure-virtual-machine/>Bicep: Execute a RunCommand on already running Azure Virtual Machine</a></li><li><a href=/docs/legacy/2023-08-25-azure-nested-virtualization-hyper-v-cannot-be-installed-because-virtualization-support-is-not-enabled-in-the-bios/>Azure Nested Virtualization: Hyper-V cannot be installed because virtualization support is not enabled in the BIOS.</a></li><li><a href=/docs/legacy/2023-08-24-how-to-restart-group-policy-client-service-gpsvc/>How to restart Group Policy Client Service (GPSVC)</a></li><li><a href=/docs/legacy/2023-08-24-free-opnsense-firewall-nva-in-azure/>Free OPNsense Firewall NVA in Azure</a></li><li><a href=/docs/legacy/2023-08-23-youve-mounted-your-storage-account-but-you-see-that-the-space-available-is-less-than-visible-on-azure-portal/>You&amp;#8217;ve mounted your storage account, but you see that the space available is less than visible on Azure Portal</a></li><li><a href=/docs/legacy/2023-08-23-bicep-basic-windows-server-deployment-template-no-public-ip-no-nsg-deployment-in-existing-network/>Bicep: Basic Windows Server deployment template, no Public IP, no NSG, deployment in existing network.</a></li><li><a href=/docs/legacy/2023-08-23-bicep-deploy-virtual-machine-scale-set-and-put-it-behind-ilb-internal-load-balancer-as-backend-pool/>Bicep: Deploy Virtual Machine Scale Set and put it behind ILB (Internal Load Balancer) as backend pool</a></li><li><a href=/docs/legacy/2023-08-23-bicep-deploy-windows-server-vm-and-join-it-to-the-domain-using-the-password-dynamically-fetched-from-the-azure-keyvault/>Bicep: Deploy Windows Server VM and join it to the Domain using the password dynamically fetched from the Azure KeyVault</a></li><li><a href=/docs/legacy/2023-08-22-bicep-deploy-40-vms-at-once-with-cse-to-auto-configure-them/>Bicep: Deploy 40 VMs at once, with CSE to auto-configure them.</a></li><li><a href=/docs/legacy/2023-08-22-deploy-cse-custom-script-extension-using-managed-identity-to-authenticate-against-storage-account-where-script-is-stored-on-existing-running-vm/>Deploy CSE (Custom Script Extension) using Managed Identity to authenticate against storage account where script is stored on existing running VM</a></li><li><a href=/docs/legacy/2023-08-22-bicep-deploy-2-node-windows-failover-cluster-in-a-proximity-placement-group-ppg-with-3-shared-clustered-disks-and-cse-for-automatic-cluster-configuration/>Bicep: Deploy 2 Node Windows Failover Cluster, in a Proximity Placement Group (PPG), with 3 shared clustered disks and CSE for automatic cluster configuration</a></li><li><a href=/docs/legacy/2023-08-22-bicep-create-empty-managed-disk/>Bicep: Create empty Managed Disk</a></li><li><a href=/docs/legacy/2023-08-22-bicep-create-a-zrs-storage-account-with-a-random-storage-account-name/>Bicep: Create a ZRS Storage Account with a random Storage Account name</a></li><li><a href=/docs/legacy/2023-08-22-bicep-deploy-ubuntu-22-04-in-existing-vnet-subnet/>Bicep: Deploy Ubuntu 22.04 in existing VNET/Subnet</a></li><li><a href=/docs/legacy/2023-08-22-bicep-deploy-standalone-rhel8-4-and-vnet-subnet-with-public-ip-address-and-nsg-attached-to-it/>Bicep: Deploy Standalone RHEL8.4 and VNET/Subnet with Public IP address and NSG attached to it</a></li><li><a href=/docs/legacy/2023-08-22-bicep-deploy-centos-7-vm-in-existing-vnet-subnet/>Bicep: Deploy Centos 7 VM in existing VNET/Subnet</a></li><li><a href=/docs/legacy/2023-08-22-bicep-deploy-rhel-vm-in-existing-vnet-subnet-vm-with-plan-information/>Bicep: Deploy RHEL VM in existing VNET/Subnet (VM With Plan Information)</a></li><li><a href=/docs/legacy/2023-08-22-c-working-with-azure-imds/>C#: Working with Azure IMDS</a></li><li><a href=/docs/legacy/2023-08-22-c-check-if-service-exists-via-wmi/>C#: Check if service exists via WMI</a></li><li><a href=/docs/legacy/2023-08-22-powershell-send-telegram-message-via-bot-using-restapi-and-bot-token/>PowerShell: Send telegram message via Bot using RestAPI and Bot Token</a></li><li><a href=/docs/legacy/2023-08-22-powershell-restart-group-policy-client-service-can-be-used-as-run-command-on-azure-portal/>Powershell: Restart Group Policy Client Service (Can only be used as Run-Command on Azure Portal)</a></li><li><a href=/docs/legacy/2023-08-22-powershell-download-and-run-sysinternals-psping-to-test-network-connectivity-over-tcp/>PowerShell: Download and run Sysinternals PSPing to test network connectivity over TCP</a></li><li><a href=/docs/legacy/2023-08-22-powershell-perform-a-process-dump-of-a-windows-service-via-sysinternals-procdump-tool/>PowerShell: Perform a process dump of a windows service via Sysinternals procdump tool</a></li><li><a href=/docs/legacy/2023-08-22-powershell-check-azurevm-license-type-hybrid-benefit/>PowerShell: Check AzureVM license type (Hybrid Benefit)</a></li><li><a href=/docs/legacy/2023-08-22-powershell-check-if-accelerated-networking-adapter-is-present-within-windows-vm/>PowerShell: Check if Accelerated Networking Adapter is present within Windows VM</a></li><li><a href=/docs/legacy/2023-08-22-powershell-join-vm-to-the-domain/>Powershell: Join VM to the Domain</a></li><li><a href=/docs/legacy/2023-08-22-azure-cli-create-ipv6-enabled-vm/>Azure CLI: Create IPV6 enabled VM</a></li><li><a href=/docs/legacy/2023-08-22-capture-network-traffic-using-windows-built-in-tools/>Capture network traffic using windows built in tools</a></li><li><a href=/docs/legacy/2023-08-22-bicep-template-deploy-centos-7-5-in-existing-vnet-subnet-from-azure-marketplace-image/>Bicep Template: Deploy Centos 7.5 in existing VNET/Subnet from Azure MarketPlace Image</a></li><li class=book-section-flat><span>Shortcodes</span><ul><li><a href=/docs/shortcodes/buttons/>Buttons</a></li><li><a href=/docs/shortcodes/columns/>Columns</a></li><li><a href=/docs/shortcodes/details/>Details</a></li><li><a href=/docs/shortcodes/expand/>Expand</a></li><li><a href=/docs/shortcodes/hints/>Hints</a></li><li><a href=/docs/shortcodes/mermaid/>Mermaid</a></li><li><input type=checkbox id=section-d4c83c0dd655503a3da63d0c6550ed41 class=toggle>
<label for=section-d4c83c0dd655503a3da63d0c6550ed41 class="flex justify-between"><a href=/docs/shortcodes/section/>Section</a></label><ul><li><a href=/docs/shortcodes/section/first-page/>First Page</a></li><li><a href=/docs/shortcodes/section/second-page/>Second Page</a></li></ul></li><li><a href=/docs/shortcodes/tabs/>Tabs</a></li><li><a href=/docs/shortcodes/katex/>KaTeX</a></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu>
</label><strong>Deploy Storage Spaces on a Single Virtual Machine to Get Optimal Performance/Cost Ratio</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></aside></header><article class="markdown book-post"><h1><a href=/posts/2023-09-25-deploy-storage-spaces-on-azure-vm/>Deploy Storage Spaces on a Single Virtual Machine to Get Optimal Performance/Cost Ratio</a></h1><h5>September 25, 2023</h5><div><a href=/categories/azure/>Azure</a>,
<a href=/categories/virtualization/>Virtualization</a>,
<a href=/categories/windows/>Windows</a></div><p>Storage Spaces is a feature of Windows Server that allows you to pool multiple physical disks together to create a single virtual disk. This can be useful for a variety of reasons, such as:</p><ul><li>To increase the overall capacity of your storage.</li><li>To improve the performance of your storage by distributing data across multiple disks.</li><li>To get azure host caching feature on disks that are higher than 4 TB.</li></ul><p>In this article, I will show you how to deploy Storage Spaces on a single virtual machine in Azure to achieve optimal storage performance with minimal cost.</p><h5 id=span-classez-toc-section-idprerequisitesspanprerequisitesspan-classez-toc-section-endspan><strong>Prerequisites</strong>
<a class=anchor href=#span-classez-toc-section-idprerequisitesspanprerequisitesspan-classez-toc-section-endspan>#</a></h5><ul><li>Azure VM with Windows Server 2012 or later.</li><li>Disks you are adding to the configuration should be at least 4GB of size or higher.</li><li>RDP access and local admin rights on the VM.</li><li>Access to Azure portal with a permission to create and attach managed disks to the VM.</li></ul><h5 id=span-classez-toc-section-idobjectivespanobjectivespan-classez-toc-section-endspan><strong>Objective</strong>
<a class=anchor href=#span-classez-toc-section-idobjectivespanobjectivespan-classez-toc-section-endspan>#</a></h5><p>Our goal is to configure multiple Azure managed disks to appear as a single virtual disk with a single partition at the Azure VM level. Given that it’s an Azure VM, disk redundancy isn’t a concern. This allows us to read and write from all disks simultaneously, enhancing performance, throughput, and even reducing latency in situations where workloads are throttled by the Azure platform.</p><ul><li>If data integrity is mission-critical and the software using the disk has its own caching mechanism (e.g., a database), set caching to none.</li><li>For read-intensive applications, opt for Read Only caching.</li><li>If data consistency isn’t a concern, choose Read-Write caching.</li><li>If uncertain about the workload type, a balanced and safe option is Read Only cache, which we’ll use in this tutorial.</li></ul><h5 id=span-classez-toc-section-idsetting_up_storage_spacesspansetting-up-storage-spacesspan-classez-toc-section-endspan><strong>Setting up Storage Spaces</strong>
<a class=anchor href=#span-classez-toc-section-idsetting_up_storage_spacesspansetting-up-storage-spacesspan-classez-toc-section-endspan>#</a></h5><p>Connect to your VM using RDP. For this tutorial, we’re using Windows Server 2019, but the steps are generally consistent across versions. In Server Manager, you’ll notice the Primordial Pool, which is a default collection of all eligible (unallocated) disks. These disks can’t be used directly but can be added to user-defined pools.</p><p>Execute the following PowerShell command with Administrator rights:</p><p><strong>Number of columns.</strong> A “column” in Storage Spaces terminology refers to a single stripe of data. When data is written to a storage space, it’s divided into stripes, and these stripes are distributed across multiple disks. To put it simply, it indicates to the storage spaces how many physical disks (Azure managed disks) we intend to write to simultaneously. The general rule of thumb is to set it to the number of disks in your storage pool, especially if you’re using simple resiliency. This is the ONLY TYPE OF RESILIENCY you should employ in Azure VMs. So, if I have 4 disks and wish to write to all of them simultaneously, I’d set this value to 4.</p><p><strong>ResiliencySettingName.</strong> As previously mentioned, this should always be set to ‘Simple’ for Azure VMs. Why? Because there’s no need to concern ourselves with physical disk failures; our workload is always virtualized. This allows us to take advantage of a “RAID 0” like setup, writing to all disks simultaneously and expanding capacity without allocating any storage space for parity. It’s illogical to expend IO on parity/redundancy operations when the platform already handles this. So, a key takeaway: Keep it simple. 😉</p><p><strong>Interleave.</strong> This parameter is a bit more nuanced. It’s essential to understand your workload to set this correctly. Generally, larger sizes, like 128KB or 256KB, are more suitable for sequential workloads such as video editing or streaming. In contrast, smaller sizes, like 16KB or 32KB, tend to be better for random I/O workloads, such as databases. It’s also vital to align this value with the NTFS block size when creating a partition. If uncertain, you can begin with a general 64KB and adjust if necessary (by creating a new volume and transferring the data) should the need arise. This is the approach I’ll be taking in this example.</p><p><strong>Usemaximumsize flag.</strong> This simply instructs the system to allocate the maximum available size to this operation.</p><p>Sample output, after running New-VirtualDisk command:</p><h4 id=span-classez-toc-section-idoptional_benchmarksspanoptional-benchmarksspan-classez-toc-section-endspan>Optional: Benchmarks
<a class=anchor href=#span-classez-toc-section-idoptional_benchmarksspanoptional-benchmarksspan-classez-toc-section-endspan>#</a></h4><p>Benchmarks provide insights into the performance of the disk setup. Use the following script to download and run the DiskSpd benchmarking tool:</p><p>$client.DownloadFile(&ldquo;<a href=https://github.com/microsoft/diskspd/releases/download/v2.1/DiskSpd.ZIP%22,%22C>https://github.com/microsoft/diskspd/releases/download/v2.1/DiskSpd.ZIP","C</a>:\Temp\DiskSpd.zip &ldquo;)
Expand-Archive -LiteralPath C:\Temp\DiskSpd.zip -DestinationPath C:\Temp\DISKSPD</p><p>#Run the benchmark, please change the D:\Testfile.dat to a path of your vdisk
#In this scenario test will run 10 minutes, 600 seconds.
#Disk SPD Samples: <a href=https://github.com/microsoft/diskspd/wiki/Sample-command-lines>https://github.com/microsoft/diskspd/wiki/Sample-command-lines</a>
C:\Temp\DISKSPD\amd64\diskspd.exe -c2G -w50 -b64K -o32 -t4 -d600 -Sh F:\testfile.dat&rdquo; role=&ldquo;button&rdquo; style=&ldquo;color:#D4D4D4;display:none&rdquo; tabindex=&ldquo;0&rdquo;>```
#Download and expland DiskSPD to a C:\Temp
$client = new-object System.Net.WebClient
$client.Proxy = [System.Net.WebRequest]::DefaultWebProxy
$client.Proxy.Credentials = [System.Net.CredentialCache]::DefaultCredentials
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
$client.DownloadFile(&ldquo;<a href=https://github.com/microsoft/diskspd/releases/download/v2.1/DiskSpd.ZIP%22>https://github.com/microsoft/diskspd/releases/download/v2.1/DiskSpd.ZIP"</a>,&ldquo;C:\Temp\DiskSpd.zip &ldquo;)
Expand-Archive -LiteralPath C:\Temp\DiskSpd.zip -DestinationPath C:\Temp\DISKSPD
#Run the benchmark, please change the D:\Testfile.dat to a path of your vdisk
#In this scenario test will run 10 minutes, 600 seconds.
#Disk SPD Samples: <a href=https://github.com/microsoft/diskspd/wiki/Sample-command-lines>https://github.com/microsoft/diskspd/wiki/Sample-command-lines</a>
C:\Temp\DISKSPD\amd64&lt;/span>diskspd.exe -c2G -w50 -b64K -o32 -t4 -d600 -Sh F:\testfile.dat</p><pre tabindex=0><code>
&lt;/div&gt;This parameter set for diskspd benchmarks a disk using a 2GB test file with a 50% read-write mix, 64KB block size, 32 concurrent I/O operations, 4 threads for 10 minutes, bypassing software cache.

&lt;figure class=&#34;wp-block-image size-full is-resized&#34;&gt;![](https://cdn.porotnikov.com/media/2023/09/25215746/image-23.png)&lt;/figure&gt;Grab a coffee for 10 minutes.

&lt;figure class=&#34;wp-block-image size-full&#34;&gt;![](https://cdn.porotnikov.com/media/2023/09/25215827/image-24.jpg)&lt;/figure&gt;You may wonder how the IOPS exceeded the disk specifications; the answer is Azure host caching.  
And why didn’t MB/s reach 500? Remember, there are always overheads: filesystem overhead, filter drivers (primarily used by the AV engine), etc.

#### &lt;span class=&#34;ez-toc-section&#34; id=&#34;Cost_Implications&#34;&gt;&lt;/span&gt;  
Cost Implications:&lt;span class=&#34;ez-toc-section-end&#34;&gt;&lt;/span&gt;

Using Azure’s cost calculator, a 1TB P30 managed disk in the North Europe region for me costs $135, offering 5000 IOPS and a 200MB/s cap.

&lt;figure class=&#34;wp-block-image size-full&#34;&gt;![](https://cdn.porotnikov.com/media/2023/09/25220320/image-24.png)&lt;/figure&gt;  
In contrast, **four** P15 disks cost $152 but provide a higher throughput of 500MB/s. For throughput-intensive workloads, using storage spaces can lead to significant cost savings.

&lt;figure class=&#34;wp-block-image size-full&#34;&gt;![](https://cdn.porotnikov.com/media/2023/09/25220338/image-25.png)&lt;/figure&gt;  
If I wanted to achieve 500 MB/s without using storage spaces, I’d have to opt for at least P60.

&lt;figure class=&#34;wp-block-image size-full&#34;&gt;![](https://cdn.porotnikov.com/media/2023/09/25220406/image-26.png)&lt;/figure&gt;At a price of $946 per month, this represents a significant cost increase for a throughput-intensive workload. Your experience might differ based on the SKU you choose.

Another advantage is the support for Azure host caching on disk sizes up to 4TB. By leveraging storage spaces, you can extend this up to 256TB (storage spaces max), but consider the limits by VM SKU.
</code></pre></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></div></aside></main></body></html>